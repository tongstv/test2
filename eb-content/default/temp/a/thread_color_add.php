<?php $sql=$func->q("SELECT * FROM tbl_tinraovat WHERE trv_id = ".$id." AND color_id = 0");if(mysql_num_rows($sql)>0){$row=mysql_fetch_assoc($sql);$arr_not_insert=array('trv_id','trv_size','trv_galerry','trv_giovang','trv_email','trv_color','ttp_id');foreach($arr_not_insert as $v){unset($row[$v]);}$row['trv_tomtat']=$row['trv_tomtat'];$row['trv_noidung']=$row['trv_noidung'];$row['trv_dieukien']=$row['trv_dieukien'];$row['color_id']=$id;$row['tv_id']=$mtv_id;$row['trv_ngaygui']=$date_time;$row['trv_ngaycapnhat']=$date_time;$str_key="";$str_val="";foreach($row as $k=>$v){$str_key.=", ".$k;$v=str_replace("'","''",$v);$str_val.=", '".$v."'";}$str_key=substr($str_key,1);$str_key=trim($str_key);$str_val=substr($str_val,1);$str_val=trim($str_val);$strsql="INSERT INTO tbl_tinraovat (".$str_key.") VALUES (".$str_val.")";$func->q($strsql);$sql=$func->q("SELECT trv_id FROM tbl_tinraovat WHERE tv_id = ".$mtv_id." ORDER BY trv_id DESC LIMIT 0, 1");if(mysql_num_rows($sql)>0){$row=mysql_fetch_assoc($sql);$trv_id=(int)$row['trv_id'];$_continue='9999/thread_edit&pid='.$trv_id;die('<script type="text/javascript">parent. window.location = "'.$web_link.$_continue.'";</script>');}$m='Không xác định được màu vừa thêm';}else{$m='Lỗi! không thêm được màu';}die('<script type="text/javascript">alert("'.$m.'");</script>'); 
