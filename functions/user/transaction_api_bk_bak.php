<?php require('../class/bk_transaction_api.php');$bk=new BKTransactionAPI("http://sandbox.baokim.vn/services/transaction_api/init?wsdl");$api_username='huynq2207';$api_password='huynq2207';$merchant_id='11';$transaction_id=time();$card_id='92';$card_id=str_replace(' ','',$card_id);$card_id=trim($card_id);$pin_field='1111111111';$pin_field=str_replace(' ','',$pin_field);$pin_field=trim($pin_field);$seri_field='1111111111';$seri_field=str_replace(' ','',$seri_field);$seri_field=trim($seri_field);$secure_pass='5653a74e12cfcd20';$arr_card_id=array(92=>'mobifone',93=>'vinaphone');if(!isset($arr_card_id[$card_id])||strlen($seri_field)<10||strlen($pin_field)<10){die('<script type="text/javascript">alert("Định dạng thẻ chưa được hỗ trợ");</script>');}$info_topup=new TopupToMerchantRequest();$info_topup->api_password=$api_password;$info_topup->api_username=$api_username;$info_topup->card_id=$card_id;$info_topup->merchant_id=$merchant_id;$info_topup->pin_field=$pin_field;$info_topup->seri_field=$seri_field;$info_topup->transaction_id=$transaction_id;$data_sign_array=(array)$info_topup;ksort($data_sign_array);$data_sign=md5($secure_pass.implode('',$data_sign_array));$info_topup->data_sign=$data_sign;$return_info=$bk->DoTopupToMerchant($info_topup);$arr_error_code=array(0=>'Success',1=>'Data request error',2=>'Wrong account api',3=>'Merchant site not found',4=>'Api account and merchant site account are not the same',5=>'Transaction id existed',6=>'Merchant account found but not available to make transaction',7=>'Receiver account not found',8=>'Receiver account found but not available to make transaction',9=>'Transaction amount is out of limited range',10=>'Escrow transaction mode is not allowed for guarantee account',11=>'Transaction create error',12=>'Info data changed - data_sign',13=>'Payment amount is out of limited range',14=>'Info card used BaoKim',15=>'Error from gateway',16=>'Card ID invalid',98=>'IP invalid',99=>'Other error');$return_info=(array)$return_info;echo '<strong>foreach</strong>:<br>';foreach($return_info as $keys=>$values){echo $keys.' - '.$values.'<br>';}$error_code=$return_info['error_code'];$error_message=$return_info['error_message'];$transaction_id=$return_info['transaction_id'];$info_card=$return_info['info_card'];$data_sign=$return_info['data_sign'];if($error_code==0){$mes='Giao dịch được thực hiện thành công. Bạn vừa nạp '.$info_card.' vào tài khoản này';}else{$mes=$arr_error_code[$error_code];} 
