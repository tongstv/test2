<?php class Func{private function d(){global $date_time;return $date_time;}private function i(){global $client_ip;return $client_ip;}private function wl(){global $web_link;return $web_link;}private function wn(){global $web_name;return $web_name;}public function full_url(){$str='http';if(isset($_SERVER['HTTPS'])){$str='https';}return $str.'://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];}public function log_file($str){$_file='error_log';if(!file_exists($_file)){$_file='../'.$_file;}if(!file_exists($_file)){die('error_log not found');}$str=str_replace("\s"," ",str_replace("\n"," ",str_replace("\r"," ",str_replace("\t"," ",$str))));error_log(date('[d-m-Y H:i:s]',time()).'; IP: '.$this->i().'. MYSQL Warning: '.$str." --------------------> URL: ".$this->full_url()."\n",3,$_file);echo '<p>#44 error.</p>';}public function q($str){$sql=mysql_query($str)or die($this->log_file($str." ------------------> ".mysql_error()));return $sql;}public function c($sql){$sql=$this->q($sql);return mysql_num_rows($sql);}public function create_static_html_name($f){$f=str_replace(" ","",$f);$f=$this->non_mark_seo($f);$f=str_replace(".","_",$f);return $f;}public function get_static_html($f,$c='',$mr='',$t=1800){global $memcache;global $memcache_host;global $localhost;if($localhost==1||$f==''){return false;}if(strlen($f)>50){$f=md5($f);}if($memcache!=false){$f=$memcache_host.$f;if($c!=''){$memcache->set($f,$c,false,$t);$this->log_cache('memcache for '.$f.': '.$_SERVER['REQUEST_URI']);}else{return $memcache->get($f);}return false;}$f='ebcache/'.$f.'.txt';if($c!=''){$this->create_file($f,$c);$this->log_cache('echcache for '.$f.': '.$_SERVER['REQUEST_URI']);}else if(file_exists($f)){$time_file=filemtime($f);if($time_file+$t+rand(0,20)>$this->d()){return file_get_contents($f,1);}}return false;}public function get_static_code($f,$c='',$t=900){if($c!=''){$this->create_file($f,$c);}else if(file_exists($f)){$time_file=filemtime($f);if($time_file+$t+rand(0,20)>$this->d()){return true;}}return false;}public function check_email_type($e_mail=''){$r=0;if($e_mail!=''){$arr=explode('@',$e_mail);if(count($arr)==2){$arr2=explode('.',$arr[1]);if(count($arr2)>1){$r=1;}}if($r==0){if(preg_match('/^([a-z]|[0-9]|\.|-|_){2,32}@([a-z]|[0-9]|\.|-|_)+\.([a-z]|[0-9]){2,4}(\.+\w+)?$/i',$e_mail)){$r=1;}}}return $r;}public function mdnam($str){$str=md5($str);$str=substr($str,2,6);return md5($str);}public function code64($str,$code){$hoc_code=str_split('qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM');if($code==1){$arr=str_split($str);$str='';foreach($arr as $v){$str.=$v.$hoc_code[rand(0,count($hoc_code)-1)];}return base64_encode($str);}else{$str=base64_decode($str);$arr=str_split($str);$str='';foreach($arr as $k=>$v){if($k%2==0){$str.=$v;}}return $str;}}public function captcha($str){$str.=$this->wl();$str=md5($str);$web=md5($str);$web=substr($web,6,4);return $web.'_'.$str;}public function non_mark_seo($str){$unicode=array('a'=>array('á','à','ả','ã','ạ','ă','ắ','ặ','ằ','ẳ','ẵ','â','ấ','ầ','ẩ','ẫ','ậ','Á','À','Ả','Ã','Ạ','Ă','Ắ','Ặ','Ằ','Ẳ','Ẵ','Â','Ấ','Ầ','Ẩ','Ẫ','Ậ'),'d'=>array('đ','Đ'),'e'=>array('é','è','ẻ','ẽ','ẹ','ê','ế','ề','ể','ễ','ệ','É','È','Ẻ','Ẽ','Ẹ','Ê','Ế','Ề','Ể','Ễ','Ệ'),'i'=>array('í','ì','ỉ','ĩ','ị','Í','Ì','Ỉ','Ĩ','Ị'),'o'=>array('ó','ò','ỏ','õ','ọ','ô','ố','ồ','ổ','ỗ','ộ','ơ','ớ','ờ','ở','ỡ','ợ','Ó','Ò','Ỏ','Õ','Ọ','Ô','Ố','Ồ','Ổ','Ỗ','Ộ','Ơ','Ớ','Ờ','Ở','Ỡ','Ợ'),'u'=>array('ú','ù','ủ','ũ','ụ','ư','ứ','ừ','ử','ữ','ự','Ú','Ù','Ủ','Ũ','Ụ','Ư','Ứ','Ừ','Ử','Ữ','Ự'),'y'=>array('ý','ỳ','ỷ','ỹ','ỵ','Ý','Ỳ','Ỷ','Ỹ','Ỵ'),'-'=>array(' ','~','`','!','@','#','$','%','^','&','*','(',')','=','[',']','{','}','\\','|',';',':','\'','"',',','<','>','/','?'));foreach($unicode as $nonUnicode=>$uni){foreach($uni as $v){$str=str_replace($v,$nonUnicode,$str);
}}$str=preg_replace('/-+-/',"-",$str);$str=preg_replace('/^\-+|\-+$/',"",$str);return strtolower($str);}public function non_mark($str){$unicode=array('a'=>array('á','à','ả','ã','ạ','ă','ắ','ặ','ằ','ẳ','ẵ','â','ấ','ầ','ẩ','ẫ','ậ'),'A'=>array('Á','À','Ả','Ã','Ạ','Ă','Ắ','Ặ','Ằ','Ẳ','Ẵ','Â','Ấ','Ầ','Ẩ','Ẫ','Ậ'),'d'=>array('đ'),'D'=>array('Đ'),'e'=>array('é','è','ẻ','ẽ','ẹ','ê','ế','ề','ể','ễ','ệ'),'E'=>array('É','È','Ẻ','Ẽ','Ẹ','Ê','Ế','Ề','Ể','Ễ','Ệ'),'i'=>array('í','ì','ỉ','ĩ','ị'),'I'=>array('Í','Ì','Ỉ','Ĩ','Ị'),'o'=>array('ó','ò','ỏ','õ','ọ','ô','ố','ồ','ổ','ỗ','ộ','ơ','ớ','ờ','ở','ỡ','ợ'),'O'=>array('Ó','Ò','Ỏ','Õ','Ọ','Ô','Ố','Ồ','Ổ','Ỗ','Ộ','Ơ','Ớ','Ờ','Ở','Ỡ','Ợ'),'u'=>array('ú','ù','ủ','ũ','ụ','ư','ứ','ừ','ử','ữ','ự'),'U'=>array('Ú','Ù','Ủ','Ũ','Ụ','Ư','Ứ','Ừ','Ử','Ữ','Ự'),'y'=>array('ý','ỳ','ỷ','ỹ','ỵ'),'Y'=>array('Ý','Ỳ','Ỷ','Ỹ','Ỵ'));foreach($unicode as $nonUnicode=>$uni){foreach($uni as $v)$str=str_replace($v,$nonUnicode,$str);}return $str;}public function shes_title($str){$str=str_replace('\\','',$str);$str=str_replace('"','',$str);$str=str_replace("'","",$str);return $str;}public function stripStyles($str){$str=preg_replace("/<script\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<script>',$str);$str=preg_replace("/<div\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<div>',$str);$str=preg_replace("/<table\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<table border="0" cellpadding="0" cellspacing="0">',$str);$str=preg_replace("/<span\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<span>',$str);$str=preg_replace("/<strong\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<strong>',$str);$str=preg_replace("/<a\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<a>',$str);$str=str_replace('&nbsp;',' ',$str);return $str;}public function stripStyleOnly($str,$tags){if(is_array($tags)){$str=str_replace('&nbsp;',' ',$str);$str=preg_replace("/<table\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<table border="0" cellpadding="0" cellspacing="0">',$str);foreach($tags as $tag)$str=preg_replace("/<".$tag."\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<'.$tag.'>',$str);return $str;}else if($tags!=''){return preg_replace("/<".$tags."\s([a-z][a-z0-9]*)[^>]*?(\/?)>/i",'<'.$tags.'>',$str);}else{return strip_tags($str);}}public function adds($str){if(get_magic_quotes_gpc()==0){return addslashes($str);}else{return $str;}}public function short_string($str,$len,$more){$str=trim($str);if($len>0&&strlen($str)>$len){$str=substr($str,0,$len);if(!substr_count($str," ")){if($more==1)$str.="...";return $str;}while(strlen($str)&&($str[strlen($str)-1]!=" "))$str=substr($str,0,-1);$str=substr($str,0,-1);if($more==1)$str.="...";}return $str;}public function del_line($str){return str_replace("\r"," ",str_replace("\n"," ",$str));}public function part_page($Page,$TotalPage,$strLinkPager){$show_page=8;$str_page='';if($Page<=$show_page){if($TotalPage<=$show_page){for($i=1;$i<=$TotalPage;$i++){if($i==$Page){$str_page.=' <a title="Trang '.$i.'" href="javascript://" class="selected"><span class="bold">[ '.$i.' ]</span></a>';}else{$str_page.=' <a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">'.$i.'</a>';}}}else{for($i=1;$i<=$show_page;$i++){if($i==$Page){$str_page.=' <a title="Trang '.$i.'" href="javascript://" class="selected"><span class="bold">[ '.$i.' ]</span></a>';}else{$str_page.=' <a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">'.$i.'</a>';}}$str_page.=' ... <a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">&gt;&gt;</a>';}}else{$chiadoi=$show_page/2;$i=$Page-($chiadoi+1);$str_page='<a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">&lt;&lt;</a> <a title="Trang 1" href="'.$strLinkPager.'1">1</a> ... ';$i++;for($i;$i<$Page;$i++){$str_page.=' <a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">'.$i.'</a>';}$str_page.=' <a title="Trang '.$i.'" href="javascript://" class="selected"><span class="bold">[ '.$i.' ]</span></a>';$i++;$_Page=$Page+$chiadoi;if($_Page>$TotalPage){$_Page=$TotalPage;}for($i;$i<$_Page;$i++){$str_page.=' <a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">'.$i.'</a>';}$str_page.=' ... <a title="Trang cuối" href="'.$strLinkPager.$TotalPage.'">'.$TotalPage.'</a> <a title="Trang '.$i.'" href="'.$strLinkPager.$i.'">&gt;&gt;</a>';}return '<div class="public-part-page"><span class="bold">Trang</span> '.$str_page.'</div>';}public function part_page_ajax($Page,$TotalPage,$strLinkPager,$return){$show_page=8;$str_page='';if($Page<=$show_page){if($TotalPage<=$show_page){for($i=1;$i<=$TotalPage;$i++){if($i==$Page){$str_page.=' <a title="Trang '.$i.'" href="javascript://"><span class="bold">[ '.$i.' ]</span></a>';}else{$str_page.=' <a title="Trang '.$i.'" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">'.$i.'</a>';}}}else{for($i=1;$i<=$show_page;$i++){if($i==$Page){$str_page.=' <a title="Trang '.$i.'" href="javascript://"><span class="bold">[ '.$i.' ]</span></a>';}else{$str_page.=' <a title="Trang '.$i.'" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">'.$i.'</a>';}}$str_page.=' ... <a title="Tiếp" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">&gt;&gt;</a>';}}else{$chiadoi=$show_page/2;$i=$Page-($chiadoi+1);$str_page='<a title="Trước" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">&lt;&lt;</a> <a title="Trang 1" onclick="ajaxl(\''.$strLinkPager.'1\',\''.$return.'\',1)" href="javascript://">1</a> ... ';$i++;for($i;$i<$Page;$i++){$str_page.=' <a title="Trang '.$i.'" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">'.$i.'</a>';}$str_page.=' <a title="Trang '.$i.'" href="javascript://"><span class="bold">[ '.$i.' ]</span></a>';$i++;$_Page=$Page+$chiadoi;if($_Page>$TotalPage){$_Page=$TotalPage;}for($i;$i<=$_Page;$i++){$str_page.=' <a title="Trang '.$i.'" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">'.$i.'</a>';}$str_page.=' ... <a title="Tiếp" onclick="ajaxl(\''.$strLinkPager.$i.'\',\''.$return.'\',1)" href="javascript://">&gt;&gt;</a>';}return '<div class="public-part-page"><span class="bold">Trang: </span> '.$str_page.'</div>';}public function build_mail_header($from_email){$headers='MIME-Version: 1.0'."\r\n";$headers.='Content-Type: text/html; charset=UTF-8'."\r\n";$headers.='From: '.$this->wn().' <'.$from_email.'>'."\r\n";$headers.='Reply-To: <'.$from_email.'>'."\r\n";$headers.='Auto-Submitted: auto-generated'."\r\n";$headers.='Return-Path: <'.$from_email.'>'."\r\n";$headers.='X-Sender: <'.$from_email.'>'."\r\n";$headers.='X-Priority: 3'."\r\n";$headers.='X-MSMail-Priority: Normal'."\r\n";$headers.='X-MimeOLE: Produced By xtreMedia'."\r\n";$headers.='X-Mailer: PHP/ '.phpversion()."\r\n";return $headers;}public function lnk_block_email($em){return 'actions/block_email&e='.base64_encode($em).'&c='.md5(substr(md5($em),0,3));}public function send_email($to_email,$title,$message,$headers){global $dir_index;global $__cf_row;global $year_curent;$message=$this->str_template($dir_index.'template/mail/mail.html',array('tmp.cf_logo'=>$__cf_row['cf_logo'],'tmp.message'=>$message,'tmp.web_name'=>$this->wn(),'tmp.web_link'=>$this->wl(),'tmp.year_curent'=>$year_curent,'tmp.cf_ten_cty'=>$__cf_row['cf_ten_cty'],'tmp.to_email'=>$to_email,'tmp.block_email'=>$this->lnk_block_email($to_email)));if(mail($to_email,$title,$message,$headers)){return true;}else{return false;}}public function log_user($lu_noidung){global $mtv_id;if($mtv_id<=0){$mtv_id=1;}$this->q("INSERT INTO tbl_log_user (lu_ngay, lu_ip, lu_noidung, tv_id) VALUES (".$this->d().", '".$this->i()."', '".$lu_noidung."', ".$mtv_id.")");return '<br />Ghi log thành công.';}public function log_cache($m){$this->q("INSERT INTO tbl_log_cache (lc_noidung) VALUES ('".$m."')");return true;}public function log_admin($la_noidung){global $mtv_id;$ad_id=1;if($mtv_id>0){$ad_id=$mtv_id;}$this->q("INSERT INTO tbl_log_admin (la_ngay, la_ip, la_noidung, ad_id) VALUES (".$this->d().", '".$this->i()."', '".$la_noidung."', ".$ad_id.")");return '<br />Ghi log thành công.';}public function log_admin_order($la_noidung,$order_id){global $mtv_id;$this->q("INSERT INTO tbl_log_admin (la_ngay, la_ip, la_noidung, hd_id, ad_id) VALUES (".$this->d().", '".$this->i()."', '".$la_noidung."', ".$order_id.", ".$mtv_id.")");return '<br />Ghi log thành công.';}public function arr_tmp($row=array(),$str=''){foreach($row as $k=>$v){$str=str_replace('{tmp.'.$k.'}',$v,$str);}return $str;}public function str_template($template,$arr,$js_css=0){global $dir_for_template;if(!file_exists($template)){$template=$dir_for_template.$template;if(!file_exists($template)){return 'File "'.$template.'" not found.';}}$template=file_get_contents($template,0);foreach($arr as $block=>$val){$template=str_replace('{'.$block.'}',$val,$template);}if($js_css==1){$template=str_replace(' href="css/',' href="'.$dir_for_template.'css/',$template);$template=str_replace(' src="javascript/',' src="'.$dir_for_template.'javascript/',$template);}return $template;}public function change_date($d){$check=$this->d()-$d;if($check<60)return 'Khoảng vài giây trước';else if($check<3600)return 'Khoảng vài phút trước';else if($check<86400)return 'Khoảng vài giờ trước';else return date('H:i a d-m-Y',$d);}public function check_strlen($str){$str=str_replace('&nbsp;',' ',$str);return $str;}public function createSelect($min,$max,$select){$str='';for($min;$min<=$max;$min++){if($min==$select)$str.='<option value="'.$min.'" selected="selected">'.$min.'</option>';else $str.='<option value="'.$min.'">'.$min.'</option>';}return $str;}public function money_format($str){return str_replace(',','.',number_format($str));}public function createDescription(){return '';
}public function yahoo_support($str){if($str=='')return;$s='';$str=explode("\n",$str);foreach($str as $k=>$v){$v=trim($v);$i=$k+1;$s.='<div><a href="ymsgr:sendim?'.$v.'"><img border="0" src="http://opi.yahoo.com/online?u='.$v.'&m=g&t=2" width="125" height="25"></a><br /><span class="bold">Online'.$i.'</span></div>';}return $s;}public function skype_support($str){if($str=='')return;$s='';$str=explode("\n",$str);foreach($str as $k=>$v){$v=trim($v);$i=$k+1;$s.='<div><a title="'.$v.'" href="callto:'.$v.'"><img src="http://mystatus.skype.com/balloon/'.$v.'" width="118" border="0" /></a><br /><span class="bold">Online'.$i.'</span></div>';}return $s;}public function load_ads($filter,$offset){$sql=$this->q("SELECT qc_link, qc_img FROM tbl_quangcao WHERE ".$filter." ORDER BY qc_ngaycapnhat DESC LIMIT 0, ".$offset);$str='';while($row=mysql_fetch_assoc($sql)){$str.=',{lnk:\''.$row['qc_link'].'\',img:\''.$row['qc_img'].'\'}';}return $str;}public function checkPostServerClient(){if($_SERVER['REQUEST_METHOD']!='POST'){die('<h1>POST DIE</h1>');exit();}$checkPostServer=str_replace('http://','',str_replace('www.','',$this->wl()));$checkPostServer=explode('/',$checkPostServer);$checkPostServer=$checkPostServer[0];$checkPostClient='';if(isset($_SERVER['HTTP_REFERER'])){$checkPostClient=$_SERVER['HTTP_REFERER'];}$checkPostClient=str_replace('http://','',str_replace('www.','',$checkPostClient));$checkPostClient=explode('/',$checkPostClient);$checkPostClient=$checkPostClient[0];if(strtolower(str_replace('m.','',$checkPostServer))!=strtolower(str_replace('m.','',$checkPostClient))){die('<h1>REFERER DIE</h1>');exit();}if(get_magic_quotes_gpc()==0){foreach($_POST as $k=>$v){$_POST[$k]=addslashes($v);}}return $_POST;}public function checkDevice(){if(isset($_SERVER['HTTP_USER_AGENT'])){$_ebArrUAAgent=strtolower($_SERVER['HTTP_USER_AGENT']);$_ebArrMobi=array('midp','j2me','avantg','ipad','iphone','docomo','novarra','palmos','palmsource','240x320','opwv','chtml','pda','windows ce','mmp/','mib/','symbian','wireless','nokia','hand','mobi','phone','cdm','up.b','audio','sie-','sec-','samsung','htc','mot-','mitsu','sagem','sony','alcatel','lg','erics','vx','nec','philips','mmm','xx','panasonic','sharp','wap','sch','rover','pocket','benq','java','pt','pg','vox','amoi','bird','compal','kg','voda','sany','kdd','dbt','sendo','sgh','gradi','jb','dddi','moto','opera mobi','opera mini','android');foreach($_ebArrMobi as $k=>$v){if(strpos($_ebArrUAAgent,$v)===false){}else{return 'mobile';break;}}}return 'pc';}public function sf($ant_id=0){$ant_id=(int)$ant_id;if($ant_id>0){$sql=$this->q("SELECT this_id FROM tbl_a_nhomtin WHERE ant_id = ".$ant_id);$row=mysql_fetch_assoc($sql);return (int)$row['this_id'];}return 0;}public function ca(){global $mtv_id;$sql=$this->q("SELECT * FROM tbl_admin WHERE tv_id = ".$mtv_id);if(mysql_num_rows($sql)>0)return mysql_fetch_assoc($sql);return false;}public function un_money_format($str){$str=trim($str);return (int)str_replace(',','',str_replace('.','',str_replace(' ','',trim($str))));}public function create_file($file_,$content_,$add_line=''){if(file_exists($file_)){if($add_line!=''){$fh=fopen($file_,'a+')or die('ERROR: open 2');}else{$fh=fopen($file_,'w+')or die('ERROR: open 2');}}else{$fh=fopen($file_,'x+')or die('ERROR: open');chmod($file_,0777);}fwrite($fh,$content_)or die('ERROR: write');fclose($fh)or die('ERROR: close');}public function str_block_fix_content($str){$arr=array('á'=>'\u00e1','à'=>'\u00e0','ả'=>'\u1ea3','ã'=>'\u00e3','ạ'=>'\u1ea1','ă'=>'\u0103','ắ'=>'\u1eaf','ặ'=>'\u1eb7','ằ'=>'\u1eb1','ẳ'=>'\u1eb3','ẵ'=>'\u1eb5','â'=>'\u00e2','ấ'=>'\u1ea5','ầ'=>'\u1ea7','ẩ'=>'\u1ea9','ẫ'=>'\u1eab','ậ'=>'\u1ead','Á'=>'\u00c1','À'=>'\u00c0','Ả'=>'\u1ea2','Ã'=>'\u00c3','Ạ'=>'\u1ea0','Ă'=>'\u0102','Ắ'=>'\u1eae','Ặ'=>'\u1eb6','Ằ'=>'\u1eb0','Ẳ'=>'\u1eb2','Ẵ'=>'\u1eb4','Â'=>'\u00c2','Ấ'=>'\u1ea4','Ầ'=>'\u1ea6','Ẩ'=>'\u1ea8','Ẫ'=>'\u1eaa','Ậ'=>'\u1eac','đ'=>'\u0111','Đ'=>'\u0110','é'=>'\u00e9','è'=>'\u00e8','ẻ'=>'\u1ebb','ẽ'=>'\u1ebd','ẹ'=>'\u1eb9','ê'=>'\u00ea','ế'=>'\u1ebf','ề'=>'\u1ec1','ể'=>'\u1ec3','ễ'=>'\u1ec5','ệ'=>'\u1ec7','É'=>'\u00c9','È'=>'\u00c8','Ẻ'=>'\u1eba','Ẽ'=>'\u1ebc','Ẹ'=>'\u1eb8','Ê'=>'\u00ca','Ế'=>'\u1ebe','Ề'=>'\u1ec0','Ể'=>'\u1ec2','Ễ'=>'\u1ec4','Ệ'=>'\u1ec6','í'=>'\u00ed','ì'=>'\u00ec','ỉ'=>'\u1ec9','ĩ'=>'\u0129','ị'=>'\u1ecb','Í'=>'\u00cd','Ì'=>'\u00cc','Ỉ'=>'\u1ec8','Ĩ'=>'\u0128','Ị'=>'\u1eca','ó'=>'\u00f3','ò'=>'\u00f2','ỏ'=>'\u1ecf','õ'=>'\u00f5','ọ'=>'\u1ecd','ô'=>'\u00f4','ố'=>'\u1ed1','ồ'=>'\u1ed3','ổ'=>'\u1ed5','ỗ'=>'\u1ed7','ộ'=>'\u1ed9','ơ'=>'\u01a1','ớ'=>'\u1edb','ờ'=>'\u1edd','ở'=>'\u1edf','ỡ'=>'\u1ee1','ợ'=>'\u1ee3','Ó'=>'\u00d3','Ò'=>'\u00d2','Ỏ'=>'\u1ece','Õ'=>'\u00d5','Ọ'=>'\u1ecc','Ô'=>'\u00d4','Ố'=>'\u1ed0','Ồ'=>'\u1ed2','Ổ'=>'\u1ed4','Ỗ'=>'\u1ed6','Ộ'=>'\u1ed8','Ơ'=>'\u01a0','Ớ'=>'\u1eda',
'Ờ'=>'\u1edc','Ở'=>'\u1ede','Ỡ'=>'\u1ee0','Ợ'=>'\u1ee2','ú'=>'\u00fa','ù'=>'\u00f9','ủ'=>'\u1ee7','ũ'=>'\u0169','ụ'=>'\u1ee5','ư'=>'\u01b0','ứ'=>'\u1ee9','ừ'=>'\u1eeb','ử'=>'\u1eed','ữ'=>'\u1eef','ự'=>'\u1ef1','Ú'=>'\u00da','Ù'=>'\u00d9','Ủ'=>'\u1ee6','Ũ'=>'\u0168','Ụ'=>'\u1ee4','Ư'=>'\u01af','Ứ'=>'\u1ee8','Ừ'=>'\u1eea','Ử'=>'\u1eec','Ữ'=>'\u1eee','Ự'=>'\u1ef0','ý'=>'\u00fd','ỳ'=>'\u1ef3','ỷ'=>'\u1ef7','ỹ'=>'\u1ef9','ỵ'=>'\u1ef5','Ý'=>'\u00dd','Ỳ'=>'\u1ef2','Ỷ'=>'\u1ef6','Ỹ'=>'\u1ef8','Ỵ'=>'\u1ef4','\''=>'\\\'',''=>'');foreach($arr as $k=>$v){if($v!=''){$str=str_replace($k,$v,$str);}}return $str;}public function create_link_to_mobile($pid,$fid,$sid,$cid,$fix_domain=''){global $act;global $id;global $m_service_name;if($fix_domain!=''){$web_link='//'.str_replace('www.','',$fix_domain);}else{$web_link='//'.str_replace('www.','',$_SERVER['HTTP_HOST']);}$str='';$str=str_replace('//m.','//',$web_link);$str=str_replace('//','http://m.',$str);$str.='/';if($cid>0){if($pid>0){$sql=$this->q("SELECT trv_id FROM tbl_tinraovat WHERE trv_id = ".$pid." LIMIT 0, 1");if(mysql_num_rows($sql)>0){$str.=$m_service_name.$pid.'/';}}else{$sql=$this->q("SELECT ant_id FROM tbl_a_nhomtin WHERE ant_id = ".$cid." OR ant_id = ".$sid." OR ant_id = ".$fid." LIMIT 0, 1");if(mysql_num_rows($sql)>0){if($fid>0){$str.='f'.$fid.'/';}else if($sid>0){$str.='s'.$sid.'/';}else{$str.='c'.$cid.'/';}}}}else if($act=='cart'){$str.='actions/cart';if($id>0){$str.='&id='.$id;}}$url_chiendich=$this->full_url();if(strstr($url_chiendich,'utm_source=')==true){$str.=strstr($url_chiendich,'?utm_source=');$str.=strstr($url_chiendich,'&utm_source=');}return $str;}public function _p_link($id,$seo){global $service_name;return $service_name.$id.'/'.$seo.'/';}public function _c_link($id,$seo,$name=''){if($name==''){$name='c';}return $name.$id.'/'.$seo.'/';}public function update_sitemap(){global $date_server;global $xml_file;global $strGlobalFilter;$m='';$content='';$tmp_link='http://{tmp.http_host}/';$content.='<?xml version="1.0" encoding="UTF-8"?><urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">';$content.='<url><loc>'.$tmp_link.'</loc><lastmod>'.$date_server.'</lastmod><changefreq>hourly</changefreq><priority>1.0</priority></url>';$sql=$this->q("SELECT ant_id, ant_seo FROM tbl_a_nhomtin WHERE ant_trangthai > 0 AND this_id = 0 ORDER BY ant_stt");while($row=mysql_fetch_assoc($sql)){$content.='<url><loc>'.$tmp_link.$this->_c_link($row['ant_id'],$row['ant_seo']).'</loc><lastmod>'.$date_server.'</lastmod><changefreq>hourly</changefreq><priority>0.9</priority></url>';$strsql=$this->q("SELECT ant_id, ant_seo FROM tbl_a_nhomtin WHERE ant_trangthai > 0 AND this_id = ".$row['ant_id']." ORDER BY ant_stt");while($rows=mysql_fetch_assoc($strsql)){$content.='<url><loc>'.$tmp_link.$this->_c_link($rows['ant_id'],$rows['ant_seo'],'s').'</loc><lastmod>'.$date_server.'</lastmod><changefreq>hourly</changefreq><priority>0.9</priority></url>';$csql=$this->q("SELECT ant_id, ant_seo FROM tbl_a_nhomtin WHERE ant_trangthai > 0 AND this_id = ".$rows['ant_id']." ORDER BY ant_stt");$site_group_c='';while($crow=mysql_fetch_assoc($csql)){$content.='<url><loc>'.$tmp_link.$this->_c_link($crow['ant_id'],$crow['ant_seo'],'f').'</loc><lastmod>'.$date_server.'</lastmod><changefreq>hourly</changefreq><priority>0.9</priority></url>';}}}$sql=$this->q("SELECT trv_id, trv_tieude, trv_seo FROM tbl_tinraovat WHERE ".$strGlobalFilter." ORDER BY trv_ngaycapnhat DESC LIMIT 0, 5000");while($row=mysql_fetch_assoc($sql)){$trv_id=$row['trv_id'];$trv_tieude=$row['trv_tieude'];$trv_seo=$row['trv_seo'];$content.='<url><loc>'.$tmp_link.$this->_p_link($trv_id,$trv_seo).'</loc><lastmod>'.$date_server.'</lastmod><changefreq>hourly</changefreq><priority>0.7</priority></url>';}$strsql=$this->q("SELECT bl_id, bl_tieude, bl_seo FROM tbl_blog WHERE bl_trangthai > 0 ORDER BY bl_ngaygui DESC LIMIT 0, 500");while($rows=mysql_fetch_assoc($strsql)){if($rows['bl_seo']==''){$rows['bl_seo']=$this->non_mark_seo($rows['bl_tieude']);}$content.='<url><loc>'.$tmp_link.'blog-'.$rows['bl_id'].'/'.$rows['bl_seo'].'.html</loc><lastmod>'.$date_server.'</lastmod><changefreq>hourly</changefreq><priority>0.5</priority></url>';}$content.='</urlset>';$fh=fopen($xml_file,'w+')or die('Khong mo duoc file');if(fwrite($fh,$content)){$m='Cập nhật site-map: '.$date_server;}else{$m='LỖI: cập nhật site-map: '.$date_server;}fclose($fh);$this->log_admin($m);return true;}}$func=new Func();