<?php function cereate_filter($o){global $date_server;global $year_curent;global $month_curent;global $day_curent;global $date_time;if($o=='all'){return '';}switch($o){case "thismonth":$thang_nay=strtotime($year_curent."-".$month_curent."-01");$return_filter="tbl_log_admin.la_ngay > ".$thang_nay;break;case "yesterday":$str_date=strtotime($date_server);$return_filter="(tbl_log_admin.la_ngay > ".($str_date-(24*3600))." AND tbl_log_admin.la_ngay < ".$str_date.")";break;case "lastmonth":$_month_curent=$month_curent-1;$_year_curent=$year_curent;if($_month_curent==0){$_month_curent=12;$_year_curent-=1;}$thang_truoc=strtotime($_year_curent."-".$_month_curent."-01");$thang_nay=strtotime($year_curent."-".$month_curent."-01");$return_filter="(tbl_log_admin.la_ngay > ".$thang_truoc." AND tbl_log_admin.la_ngay < ".$thang_nay.")";break;case "last7days":$return_filter="tbl_log_admin.la_ngay > ".($date_time-(24*3600*7));break;case "last30days":$return_filter="tbl_log_admin.la_ngay > ".($date_time-(24*3600*30));break;case "today":$return_filter="tbl_log_admin.la_ngay > ".strtotime($date_server);break;default:$return_filter="tbl_log_admin.la_ngay > ".($date_time-(24*3600));}return " AND ".$return_filter;}$strLinkPager='9999/log_admin';$threadInPage=68;$strFilter="";$str_page='';$type_display='';$type_search='';$search='';$filter='';if(isset($_GET['d'])&&($filter=trim($_GET['d']))!=''){$type_display=$filter;$strLinkPager.='&d='.$filter;}$strFilter.=cereate_filter($filter);if($id>0){$strFilter.=" AND tbl_log_admin.hd_id = ".$id;$strLinkPager.='&id='.$id;}if(isset($_GET['mid'])&&($mid=(int)$_GET['mid'])>0){$strFilter.=" AND tbl_log_admin.ad_id = ".$mid;$strLinkPager.='&mid='.$mid;}if(isset($_REQUEST['t_search'])&&($search=trim($_REQUEST['t_search']))!=''){$strLinkPager.='&search='.$search;$type_search.='&t_search='.$search;if(is_numeric($search)){$strFilter.=" AND tbl_log_admin.hd_id LIKE '%{$search}%'";}else{$strFilter.=" AND tbl_log_admin.ad_id IN (select tv_id from tbl_thanhvien where tv_email like '%{$search}%')";}}$sql=$func->q("SELECT la_id FROM tbl_log_admin WHERE ad_id > 0".$strFilter);$totalThread=mysql_num_rows($sql);if($totalThread>0){$totalPage=ceil($totalThread/$threadInPage);if($page>$totalPage){$page=$totalPage;}$offset=($page-1)*$threadInPage;$sql=$func->q("SELECT tbl_log_admin.*, tbl_thanhvien.tv_email FROM tbl_log_admin, tbl_thanhvien WHERE tbl_log_admin.ad_id = tbl_thanhvien.tv_id ".$strFilter." ORDER BY tbl_log_admin.la_id DESC LIMIT ".$offset.", ".$threadInPage);while($row=mysql_fetch_assoc($sql))$main_content.=' <tr> <td><a href="9999/log_admin&mid='.$row["ad_id"].'">'.$row['ad_id'].'</a></td> <td><a href="9999/members_details&tv_id='.$row["ad_id"].'">'.$row['tv_email'].'</a></td> <td>'.date('d/m/Y (H:i)',$row["la_ngay"]).'</td> <td>'.$row['la_ip'].'</td> <td><a href="9999/log_admin&id='.$row['hd_id'].'">'.$row['hd_id'].'</a> <a href="9999/invoice_details&id='.$row['hd_id'].'" target="_blank"><i class="fa fa-external-link"></i></a></td> <td>'.$row['la_noidung'].'</td> </tr> ';if($totalPage>1){$str_page=$func->part_page($page,$totalPage,$strLinkPager.'&p=');}}else{$str_page='<h2 align="center">Không có dữ liệu...</h2>';}$main_content=$func->str_template($dir_admin.'template/log_admin.html',array('tmp.js'=>'var type_display=\''.$type_display.'\',type_search=\''.$type_search.'\',year_curent='.$year_curent.',month_curent='.$month_curent.',day_curent='.$day_curent.';','tmp.totalThread'=>$totalThread,'tmp.search'=>$search,'tmp.str_page'=>$str_page,'tmp.main_content'=>$main_content)); 
